const locales = {
  en: "GB",
  hi: "IN",
  pt: "BR",
  es: "ES",
  fil: "PH",
  ar: "SA",
  bn: "BD",
  id: "ID",
  th: "TH",
  vi: "VN"
};

function getFlagSrc(countryCode) {
  return /^[A-Z]{2}$/.test(countryCode) ? `https://flagsapi.com/${countryCode}/shiny/64.png` : "";
}

const dropdownBtn = document.getElementById("dropdown-btn");
const dropdownContent = document.getElementById("dropdown-content");

function setSelectedLocale(locale) {
  const langName = new Intl.DisplayNames([locale], { type: "language" }).of(locale);
  dropdownContent.innerHTML = "";

  for (const key in locales) {
    if (key !== locale) {
      const listEl = document.createElement("li");
      listEl.innerHTML = `${new Intl.DisplayNames([key], { type: "language" }).of(key)} <img alt="flag" src="${getFlagSrc(locales[key])}" />`;
      listEl.value = key;
      listEl.addEventListener("click", function () {
        setSelectedLocale(key);
      });
      dropdownContent.appendChild(listEl);
    }
  }

  dropdownBtn.innerHTML = `<img alt="flag" src="${getFlagSrc(locales[locale])}" /> ${langName} <span class="arrow-up"></span>`;

  // Redirect logic
  const redirectUrl = getRedirectUrl(locale);
  window.location.href = redirectUrl; // Redirect to the selected language URL
}

function getRedirectUrl(locale) {
  switch (locale) {
    case "en":
      return "/index.html";
    case "pt":
    case "es":
    case "fil":
    case "ar":
    case "bn":
    case "id":
    case "th":
    case "vi":
      return `/${locale}/`;
    default:
      return "/";
  }
}

// Detect current language from <html lang="xx"> attribute
const currentLang = document.documentElement.lang.toLowerCase().trim().split('-')[0];

// Initialize with the detected language or default to English
setSelectedLocale(currentLang || 'en');
