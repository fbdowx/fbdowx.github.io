$(document).ready(function() {
   const translations = {
        "en": {
            "No Video Found.": "No Video Found.",
            "Quality": "Quality",
            "Size": "Size",
            "Download": "Download",
            "Download Only Audio": "Download Only Audio",
            "Available Higher Qualities (Without Audio) :": "Available Higher Qualities (Without Audio) :",
            "XHR response code is not 200 (${xhr.status})": "XHR response code is not 200 (${xhr.status})",
            "An error occurred. Please try again later.": "An error occurred. Please try again later.",
            "404 Not Found": "404 Not Found",
            "500 Internal Server Error": "500 Internal Server Error",
            "505 HTTP Version Not Supported": "505 HTTP Version Not Supported",
            "An error occurred. Please try again later.": "An error occurred. Please try again later."
        },
        "es": {
            "No Video Found.": "No se encontró el video.",
            "Quality": "Calidad",
            "Size": "Tamaño",
            "Download": "Descargar",
            "Download Only Audio": "Descargar solo audio",
            "Available Higher Qualities (Without Audio) :": "Calidades superiores disponibles (sin audio) :",
            "XHR response code is not 200 (${xhr.status})": "El código de respuesta XHR no es 200 (${xhr.status})",
            "An error occurred. Please try again later.": "Ocurrió un error. Por favor, inténtelo más tarde.",
            "404 Not Found": "404 No encontrado",
            "500 Internal Server Error": "500 Error interno del servidor",
            "505 HTTP Version Not Supported": "505 Versión HTTP no soportada",
            "An error occurred. Please try again later.": "Ocurrió un error. Por favor, inténtelo más tarde."
        },
        "ar": {
            "No Video Found.": "لم يتم العثور على فيديو.",
            "Quality": "الجودة",
            "Size": "الحجم",
            "Download": "تحميل",
            "Download Only Audio": "تحميل الصوت فقط",
            "Available Higher Qualities (Without Audio) :": "جودات أعلى متوفرة (بدون صوت) :",
            "XHR response code is not 200 (${xhr.status})": "رمز استجابة XHR ليس 200 (${xhr.status})",
            "An error occurred. Please try again later.": "حدث خطأ. يرجى المحاولة مرة أخرى لاحقًا.",
            "404 Not Found": "404 لم يتم العثور على الصفحة",
            "500 Internal Server Error": "500 خطأ في الخادم الداخلي",
            "505 HTTP Version Not Supported": "505 إصدار HTTP غير مدعوم",
            "An error occurred. Please try again later.": "حدث خطأ. يرجى المحاولة مرة أخرى لاحقًا."
        },
        "pt": {
            "No Video Found.": "Nenhum vídeo encontrado.",
            "Quality": "Qualidade",
            "Size": "Tamanho",
            "Download": "Baixar",
            "Download Only Audio": "Baixar apenas áudio",
            "Available Higher Qualities (Without Audio) :": "Qualidades superiores disponíveis (sem áudio) :",
            "XHR response code is not 200 (${xhr.status})": "O código de resposta XHR não é 200 (${xhr.status})",
            "An error occurred. Please try again later.": "Ocorreu um erro. Por favor, tente novamente mais tarde.",
            "404 Not Found": "404 Não encontrado",
            "500 Internal Server Error": "500 Erro interno do servidor",
            "505 HTTP Version Not Supported": "505 Versão HTTP não suportada",
            "An error occurred. Please try again later.": "Ocorreu um erro. Por favor, tente novamente mais tarde."
        },
        "bn": {
            "No Video Found.": "কোন ভিডিও পাওয়া যায়নি।",
            "Quality": "গুণমান",
            "Size": "আকার",
            "Download": "ডাউনলোড",
            "Download Only Audio": "শুধুমাত্র অডিও ডাউনলোড করুন",
            "Available Higher Qualities (Without Audio) :": "উচ্চতর গুণমান পাওয়া যায় (অডিও ছাড়া) :",
            "XHR response code is not 200 (${xhr.status})": "XHR প্রতিক্রিয়া কোড 200 নয় (${xhr.status})",
            "An error occurred. Please try again later.": "একটি ত্রুটি ঘটেছে. দয়া করে পরে আবার চেষ্টা করুন।",
            "404 Not Found": "404 পাওয়া যায়নি",
            "500 Internal Server Error": "500 অভ্যন্তরীণ সার্ভার ত্রুটি",
            "505 HTTP Version Not Supported": "505 HTTP সংস্করণ সমর্থিত নয়",
            "An error occurred. Please try again later.": "একটি ত্রুটি ঘটেছে. দয়া করে পরে আবার চেষ্টা করুন।"
        },
        "th": {
            "No Video Found.": "ไม่พบวิดีโอ",
            "Quality": "คุณภาพ",
            "Size": "ขนาด",
            "Download": "ดาวน์โหลด",
            "Download Only Audio": "ดาวน์โหลดเฉพาะเสียง",
            "Available Higher Qualities (Without Audio) :": "คุณภาพที่สูงกว่าที่มีอยู่ (ไม่มีเสียง) :",
            "XHR response code is not 200 (${xhr.status})": "รหัสการตอบสนอง XHR ไม่ใช่ 200 (${xhr.status})",
            "An error occurred. Please try again later.": "เกิดข้อผิดพลาด โปรดลองอีกครั้งในภายหลัง",
            "404 Not Found": "404 ไม่พบ",
            "500 Internal Server Error": "500 ข้อผิดพลาดของเซิร์ฟเวอร์ภายใน",
            "505 HTTP Version Not Supported": "505 ไม่รองรับเวอร์ชัน HTTP",
            "An error occurred. Please try again later.": "เกิดข้อผิดพลาด โปรดลองอีกครั้งในภายหลัง"
        },
        "vi": {
            "No Video Found.": "Không tìm thấy video.",
            "Quality": "Chất lượng",
            "Size": "Kích thước",
            "Download": "Tải xuống",
            "Download Only Audio": "Chỉ tải xuống âm thanh",
            "Available Higher Qualities (Without Audio) :": "Chất lượng cao hơn có sẵn (không có âm thanh) :",
            "XHR response code is not 200 (${xhr.status})": "Mã phản hồi XHR không phải là 200 (${xhr.status})",
            "An error occurred. Please try again later.": "Đã xảy ra lỗi. Vui lòng thử lại sau.",
            "404 Not Found": "404 Không tìm thấy",
            "500 Internal Server Error": "500 Lỗi máy chủ nội bộ",
            "505 HTTP Version Not Supported": "505 Phiên bản HTTP không được hỗ trợ",
            "An error occurred. Please try again later.": "Đã xảy ra lỗi. Vui lòng thử lại sau."
        },
        "tl": {
            "No Video Found.": "Walang nahanap na video.",
            "Quality": "Kalidad",
            "Size": "Laki",
            "Download": "I-download",
            "Download Only Audio": "I-download lang ang audio",
            "Available Higher Qualities (Without Audio) :": "Mas mataas na kalidad na magagamit (walang audio) :",
            "XHR response code is not 200 (${xhr.status})": "Hindi 200 ang response code ng XHR (${xhr.status})",
            "An error occurred. Please try again later.": "May nangyaring mali. Pakisubukang muli mamaya.",
            "404 Not Found": "404 Hindi nahanap",
            "500 Internal Server Error": "500 Panloob na error sa server",
            "505 HTTP Version Not Supported": "505 Hindi suportado ang bersyon ng HTTP",
            "An error occurred. Please try again later.": "May nangyaring mali. Pakisubukang muli mamaya."
        },
        "id": {
            "No Video Found.": "Tidak ada video ditemukan.",
            "Quality": "Kualitas",
            "Size": "Ukuran",
            "Download": "Unduh",
            "Download Only Audio": "Unduh Audio Saja",
            "Available Higher Qualities (Without Audio) :": "Kualitas Lebih Tinggi Tersedia (Tanpa Audio) :",
            "XHR response code is not 200 (${xhr.status})": "Kode respons XHR bukan 200 (${xhr.status})",
            "An error occurred. Please try again later.": "Terjadi kesalahan. Silakan coba lagi nanti.",
            "404 Not Found": "404 Tidak Ditemukan",
            "500 Internal Server Error": "500 Kesalahan Server Internal",
            "505 HTTP Version Not Supported": "505 Versi HTTP Tidak Didukung",
            "An error occurred. Please try again later.": "Terjadi kesalahan. Silakan coba lagi nanti."
        }
    };

    function translateText(text, lang) {
        return translations[lang][text] || text;
    }

    const lang = document.documentElement.lang || "en";

    function showError(message) {
        const translatedMessage = translateText(message, lang);
        $('#result').html(`<div class="error"><i class="err"></i> ${translatedMessage}</div>`).fadeIn().delay(2000).fadeOut();
    }

    function handleResponse(response) {
        const showNoVideoFound = () => {
            $('#result').html(`<div class="error"><i class="err"></i> ${translateText("No Video Found.", lang)}</div>`).fadeIn().delay(2000).fadeOut();
        };
        const processVideoLinks = () => {
            const videoLinks = Object.entries(response.code2.links);
            if (!videoLinks.length) showNoVideoFound();
            else {
                let linksHTML = '';
                let loadedCount = 0;
                const totalVideos = videoLinks.length;
                videoLinks.forEach(([key, value]) => {
                    const videoUrl = value.url;
                    GetVideoDimension(videoUrl, (width, height) => {
                        linksHTML += `<div class="links"><div><i class="fa fa-file-video-o"></i></div><div>${translateText("Quality", lang)} - <span id="quality">${width}p</span><br/>${translateText("Size", lang)} - <span id="size">${value.size}</span></div><div><a id="vid" href="${value.url}" class="dlb ripple-btn">${translateText("Download", lang)}</a></div></div>`;
                        loadedCount++;
                        if (loadedCount === totalVideos) {
                            linksHTML = $(linksHTML).sort((a, b) => parseInt($(b).find('#quality').text()) - parseInt($(a).find('#quality').text()));
                            $('#links').html(linksHTML);
                            $('#video, #audio, #preview, #qt').show();
                            $('#b').hide();
                        }
                    });
                });
            }
        };
        const processAudioLinks = () => {
            if (!response.code1.audio || !response.code1.audio.length) return;
            response.code1.audio.forEach(audio => {
                $('#audio').append(`<div>${translateText("Download Only Audio", lang)} <span id="size">${audio.size}</span> <a id="vid2" href="${audio.url}" class="dlb ripple-btn">${translateText("Download", lang)}</a></div>`);
            });
        };
        const processVideos = () => {
            if (!response.code1.video || !response.code1.video.length) return;
            response.code1.video.sort((a, b) => convertToBytes(b.size) - convertToBytes(a.size));
            response.code1.video.forEach(video => {
                $('#video').append(`<div class="links"><div>${translateText("Quality", lang)} - <span id="quality">${video.quality}</span><br/>${translateText("Size", lang)} - <span id="size">${video.size}</span></div><div><a id="vid2" href="${video.url}" class="dlb ripple-btn">${translateText("Download", lang)}</a></div></div>`);
            });
        };
        const convertToBytes = sizeString => {
            const size = parseFloat(sizeString);
            const unit = sizeString.slice(-2).trim().toUpperCase();
            if (unit === "KB") return size * 1024;
            else if (unit === "MB") return size * 1024 * 1024;
            else if (unit === "GB") return size * 1024 * 1024 * 1024;
            return 0;
        };
        if (response.code1 && response.code1.errorResponse && response.code1.errorResponse.video_and_audio && response.code1.errorResponse.video_and_audio.error === "Video and Audio not found." && response.code2 && response.code2.links && response.code2.links.message === "No video available") {
            showNoVideoFound();
        } else {
            $('#result').html(`<div class="app"><div id="b"></div><div id="preview" style="display: none"></div><div class="lc"><div id="links"></div></div><div id="audio" style="display: none"></div><div class="lc"><div id="qt" style="display: none">${translateText("Available Higher Qualities (Without Audio) :", lang)}</div><div id="video" style="display: none"></div></div></div>`).fadeIn();
            $('#preview').html(`<div id="title"><span>${response.code1.video_info[0].title}</span></div><br/><video id="play" controls></video><div style="height: 10px"></div>`);
            $('#play').attr('src', response.code2.links.hd?.url || response.code2.links.sd?.url);
            $('#b').html('<div class="spinner bla"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');
            processVideoLinks();
            processAudioLinks();
            processVideos();
        }
    }

    function fetchData() {
        const sourceUrl = $('#source_url').val();
        $('#get').html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>').fadeIn();
        $('#result').html('').fadeIn();
        $.ajax({
            type: 'POST',
            url: '/a.php',
            data: { source_url: sourceUrl },
            success: function(response, status, xhr) {
                if (xhr.status === 200) {
                    $('#result').fadeOut(() => handleResponse(response));
                    $('#get').html(translateText('Download', lang));
                } else {
                    console.error('Error:', translateText(`XHR response code is not 200 (${xhr.status})`, lang));
                    showError('An error occurred. Please try again later.');
                    $('#get').html(translateText('Download', lang));
                }
            },
            error: function(xhr, status, error) {
                if (xhr.status === 400) {
                    const errorContent = JSON.parse(xhr.responseText).error;
                    $('#result').html(`<div class="error"><i class="err"></i>${errorContent}</div>`);
                    setTimeout(function() {
                        $('#result').html('');
                    }, 2000); // Remove error message after 2 seconds
                } else if (xhr.status === 404) {
                    showError('404 Not Found');
                } else if (xhr.status === 500) {
                    showError('500 Internal Server Error');
                } else if (xhr.status === 505) {
                    showError('505 HTTP Version Not Supported');
                } else {
                    showError('An error occurred. Please try again later.');
                }
                $('#get').html(translateText('Download', lang));
            }
        });
    }

    function GetVideoDimension(videoUrl, callback) {
        const video = document.createElement('video');
        video.src = videoUrl;
        video.addEventListener('loadedmetadata', function() {
            callback(this.videoWidth, this.videoHeight);
        });
    }

    $('#get').click(fetchData);
 });
